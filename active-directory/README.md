# ðŸ“‚ Active Directory

## **Active Directory Basics**

Active Directory (AD) is a directory service for Windows network environments.\
AD provides authentication and authorization functions within a Windows domain environment.\
It's a hierarchical structure that allows for centralized management of an organization's resources

Resources in AD can be users, computers, groups, network devices, file shares, group policies, devices, and trusts. Any user in AD, regardless of their privileges, can be used to enumerate most objects within the AD environment.&#x20;

Many features in AD are not secure by default and can be easily misconfigured.\
This weakness can be leveraged to move laterally and vertically within a network and gain unauthorized access.

***

## **Useful Resources**

#### **Learning Resources**

* [https://book.hacktricks.xyz/windows-hardening/active-directory-methodology#basic-overview](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology#basic-overview)
* [https://www.hackthebox.com/blog/active-directory-penetration-testing-cheatsheet-and-guide](https://www.hackthebox.com/blog/active-directory-penetration-testing-cheatsheet-and-guide)
* [https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberos-authentication](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberos-authentication)
* [https://academy.hackthebox.com/module/details/74](https://academy.hackthebox.com/module/details/74)
* [https://www.geeksforgeeks.org/active-directory-pentesting/](https://www.geeksforgeeks.org/active-directory-pentesting/)

#### **Other Useful Resources & Cheatsheets**

* [https://wadcoms.github.io/](https://wadcoms.github.io/)
* [https://github.com/geeksniper/active-directory-pentest](https://github.com/geeksniper/active-directory-pentest)

#### **Active Directory Helper Tools**

| Tool                                                                                                                                          | Description                                                                                                                                                                                                                                                                                 |
| --------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Ghostpack Compiled Binaries](https://github.com/r3motecontrol/Ghostpack-CompiledBinaries)                                                    | Repository containing some of the following tools' pre-compiled binaries                                                                                                                                                                                                                    |
| [PowerView](https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1)                                                   | PowerView is one of the main powershell tools to perform network and Windows domain enumeration and exploitation. It is useful for checking access, permissions, but also to enumerate potential users for Kerberoasting/ASREPRoasting attacks                                              |
| [Mimikatz](https://github.com/ParrotSec/mimikatz)                                                                                             | Performs many functions. Noteably, pass-the-hash attacks, extracting plaintext passwords, and kerberos ticket extraction from memory on host.                                                                                                                                               |
| [Active Directory Built-In PowerShell Module](https://learn.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps) | Built-In Cmdlets to manage Active Directory domains, useful tool for enumeration                                                                                                                                                                                                            |
| [SharpView](https://github.com/dmchell/SharpView)                                                                                             | Sharpview is the C# version of PowerView                                                                                                                                                                                                                                                    |
| [BloodHound](https://github.com/BloodHoundAD/BloodHound)                                                                                      | Visually map out AD relationships and help plan attack paths that may otherwise go unnoticed.                                                                                                                                                                                               |
| [SharpHound](https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors)                                                               | Data collector to gather information from Active Directory about varying AD objects such as users, groups, computers, ACLs, GPOs, user and computer attributes, user sessions, and more. The tool produces JSON files which can then be ingested into the BloodHound GUI tool for analysis. |
| [BloodHound.py](https://github.com/fox-it/BloodHound.py)                                                                                      | A Python-based BloodHound ingestor based on the [Impacket toolkit](https://github.com/CoreSecurity/impacket/). It supports most BloodHound collection methods and **can be run from a non-domain joined attacker host**. The output can be ingested into the BloodHound GUI for analysis.   |
| [Kerbrute](https://github.com/ropnop/kerbrute)                                                                                                | A tool written in Go that uses Kerberos Pre-Authentication to enumerate Active Directory accounts and perform password spraying and brute forcing.                                                                                                                                          |
| [Impacket toolkit](https://github.com/SecureAuthCorp/impacket)                                                                                | A collection of tools written in Python for interacting with network protocols. The suite of tools contains various scripts for enumerating and attacking Active Directory.                                                                                                                 |
| [Responder](https://github.com/lgandx/Responder)                                                                                              | Tool to poison LLMNR, NBT-NS and MDNS, with many different functions.                                                                                                                                                                                                                       |
| [Inveigh.ps1](https://github.com/Kevin-Robertson/Inveigh/blob/master/Inveigh.ps1)                                                             | Similar to Responder, a PowerShell tool for performing various network spoofing and poisoning attacks.                                                                                                                                                                                      |
| [C# Inveigh (InveighZero)](https://github.com/Kevin-Robertson/Inveigh/tree/master/Inveigh)                                                    | C# version of Inveigh with a semi-interactive console for interacting with captured data such as username and password hashes.                                                                                                                                                              |
| [rpcclient](https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html)                                                               | Tool that can be used to perform a variety of Active Directory enumeration tasks via the remote RPC service.                                                                                                                                                                                |
| [CrackMapExec (CME)](https://github.com/byt3bl33d3r/CrackMapExec)                                                                             | CME is an enumeration, attack, and post-exploitation toolkit. CME attempts to "live off the land" and abuse built-in AD features and protocols such as SMB, WMI, WinRM, and MSSQL.                                                                                                          |
| [Rubeus](https://github.com/GhostPack/Rubeus)                                                                                                 | C# tool built for Kerberos Abuse.                                                                                                                                                                                                                                                           |
| [GetUserSPNs.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetUserSPNs.py)                                              | Impacket module geared towards finding Service Principal names tied to normal users. Useful for Kerberoasting attacks.                                                                                                                                                                      |
| [enum4linux-ng](https://github.com/cddmp/enum4linux-ng)                                                                                       | Tool for enumerating information from Windows and Samba systems.                                                                                                                                                                                                                            |
| [ldapsearch](https://linux.die.net/man/1/ldapsearch)                                                                                          | Built in interface for interacting with the LDAP protocol.                                                                                                                                                                                                                                  |
| [windapsearch](https://github.com/ropnop/windapsearch)                                                                                        | A Python script used to enumerate AD users, groups, and computers using LDAP queries. Useful for automating custom LDAP queries.                                                                                                                                                            |
| [DomainPasswordSpray.ps1](https://github.com/dafthack/DomainPasswordSpray)                                                                    | DomainPasswordSpray is a tool written in PowerShell to perform a password spray attack against users of a domain.                                                                                                                                                                           |
| [LAPSToolkit](https://github.com/leoloobeek/LAPSToolkit)                                                                                      | Tool to leverage PowerView to audit and attack Active Directory environments that have deployed Microsoft's Local Administrator Password Solution (LAPS).                                                                                                                                   |
| [Snaffler](https://github.com/SnaffCon/Snaffler)                                                                                              | Tool for finding useful information and credentials in Active Directory on computers with accessible file shares.                                                                                                                                                                           |
| [setspn.exe](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731241\(v=ws.11\))           | Reads, modifies, and deletes the Service Principal Names (SPN) directory property for an Active Directory service account. Useful for a targeted kerberoasting attack                                                                                                                       |
| [secretsdump.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py)                                              | Remotely dump SAM and LSA secrets from a host.                                                                                                                                                                                                                                              |
| [evil-winrm](https://github.com/Hackplayers/evil-winrm)                                                                                       | Provides us with an interactive shell on host over the WinRM protocol.                                                                                                                                                                                                                      |
| [mssqlclient.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py)                                              | Part of Impacket toolset, it provides the ability to interact with MSSQL databases.                                                                                                                                                                                                         |
| [noPac.py](https://github.com/Ridter/noPac)                                                                                                   | Exploit combo using CVE-2021-42278 and CVE-2021-42287 to impersonate Domain Admin from standard domain user.                                                                                                                                                                                |
| [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py)                                                | Part of the Impacket toolset, it performs SMB relay attacks.                                                                                                                                                                                                                                |
| [gettgtpkinit.py](https://github.com/dirkjanm/PKINITtools/blob/master/gettgtpkinit.py)                                                        | Tool for manipulating certificates and TGTs.                                                                                                                                                                                                                                                |
| [adidnsdump](https://github.com/dirkjanm/adidnsdump)                                                                                          | A tool for enumeration and dumping of DNS records from a domain. Similar to performing a DNS Zone transfer.                                                                                                                                                                                 |
| [gpp-decrypt](https://github.com/t0thkr1s/gpp-decrypt)                                                                                        | Extracts usernames and passwords from Group Policy preferences.                                                                                                                                                                                                                             |
| [GetNPUsers.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py)                                                | Attempt to list and get TGTs for those users that have the property 'Do not require Kerberos preauthentication' set.                                                                                                                                                                        |
| [lookupsid.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/lookupsid.py)                                                  | SID bruteforcing tool.                                                                                                                                                                                                                                                                      |
| [ticketer.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketer.py)                                                    | A tool for creation and customization of TGT/TGS tickets.                                                                                                                                                                                                                                   |
| [raiseChild.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/raiseChild.py)                                                | Part of the Impacket toolset, It is a tool for child to parent domain privilege escalation.                                                                                                                                                                                                 |
| [Active Directory Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer)                                               | AD viewer and editor that can be used to navigate an AD database and view object properties and attributes. It can also be used to save a snapshot of an AD database for offline analysis.                                                                                                  |
| [PingCastle](https://www.pingcastle.com/documentation/)                                                                                       | Used for auditing the security level of an AD environment                                                                                                                                                                                                                                   |
| [Group3r](https://github.com/Group3r/Group3r)                                                                                                 | Group3r is useful for auditing and finding security misconfigurations in AD Group Policy Objects (GPO).                                                                                                                                                                                     |
| [ADRecon](https://github.com/adrecon/ADRecon)                                                                                                 | A tool used to extract various data from a target AD environment.                                                                                                                                                                                                                           |
